<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Almuerzo Agrivoltaico • Seminar Platform</title>
  <meta name="description" content="An informal seminar series to share advances in agrivoltaics in Latin America (EN/ES)." />
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="preconnect" href="https://esm.sh" crossorigin />
</head>
<body>
  <header class="site-header">
    <div class="container header-grid">
      <div class="brand">
        <a href="#" class="logo-circle">A</a>
        <div class="brand-text">
          <div class="title">Almuerzo Agrivoltaico</div>
          <div class="subtitle" data-i18n="tagline">An informal seminar series to share advances in agrivoltaics in Latin America</div>
        </div>
      </div>
      <nav class="nav">
        <button id="btnSchedule" class="link" data-i18n="nav.schedule">Schedule</button>
        <!-- Community button can be re-enabled later if a dedicated community page is built -->
        <!-- <button id="btnCommunity" class="link" data-i18n="nav.community">Community</button> -->
        <button id="btnAdmin" class="link" data-i18n="nav.admin" style="display:none;">Admin</button>
        <div class="divider"></div>
        <div class="lang-switch">
          <button class="chip" data-lang="en">EN</button>
          <button class="chip" data-lang="es">ES</button>
        </div>
        <div class="auth-area">
          <span id="userName"></span>
          <button id="btnSignIn" class="btn-primary" data-i18n="auth.signin">Sign in</button>
          <button id="btnSignOut" class="btn-ghost" data-i18n="auth.signout" style="display:none;">Sign out</button>
        </div>
      </nav>
    </div>
  </header>

  <div id="flash" class="flash" role="status" aria-live="polite"></div>

  <main class="container">
    <!-- Hero (shown to logged-out users on the main page) -->
    <section id="hero" class="card hero">
      <h1>Almuerzo Agrivoltaico</h1>
      <p data-i18n="intro">
        Agrivoltaics (agrivoltaics) is an emerging field that integrates solar energy with crop/livestock production.
        This bilingual seminar focuses on Latin America. Hosted by UNAM and University of Arizona.
      </p>
      <div class="meta">
        <span class="meta-item" data-i18n="format">Online • Monthly • 1 hour (30 min talk + 30 min discussion)</span>
        <span class="meta-item" data-i18n="hosted">Hosted by UNAM & University of Arizona</span>
      </div>
    </section>

    <!-- Auth (shown when sign-in is required) -->
    <section id="auth" class="card" aria-labelledby="authTitle" style="display:none;">
      <div class="auth-centered">
        <h2 id="authTitle" data-i18n="auth.title">Sign in to participate</h2>
        <p data-i18n="auth.reason">You'll need an account to RSVP, follow events, and join the discussion.</p>

        <button id="btnGoogle" class="btn-social btn-google">
          <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24">
            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"></path>
            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path>
            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path>
            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path>
            <path d="M1 1h22v22H1z" fill="none"></path>
          </svg>
          <span data-i18n="auth.google">Sign in with Google</span>
        </button>

        <div class="separator" data-i18n="auth.or">or</div>

        <form id="emailForm" class="auth-form-secondary">
          <label for="email" class="sr-only" data-i18n="auth.email">Email</label>
          <input id="email" type="email" placeholder="you@example.com" required data-i18n-placeholder="auth.email" />
          <button class="btn-secondary" type="submit" data-i18n="auth.magic">Send magic link</button>
        </form>
      </div>
    </section>

    <!-- Schedule -->
    <section id="schedule" class="card" aria-labelledby="scheduleTitle" style="display:none;">
      <div class="section-header">
        <h2 id="scheduleTitle" data-i18n="schedule.title">Event Schedule</h2>
        <div class="event-filters">
          <div class="filter-group" id="eventTimeFilter">
            <button class="chip active" data-filter="upcoming" data-i18n="filter.upcoming">Upcoming</button>
            <button class="chip" data-filter="past" data-i18n="filter.past">Past</button>
            <button class="chip" data-filter="all" data-i18n="filter.all">All</button>
          </div>
          <div class="filter-group">
            <label for="langFilter" class="sr-only" data-i18n="filter.language">Language</label>
            <select id="langFilter">
              <option value="all" data-i18n="lang.all">All Languages</option>
              <option value="en" data-i18n="lang.en">English</option>
              <option value="es" data-i18n="lang.es">Español</option>
              <option value="bi" data-i18n="lang.bi">Bilingual</option>
            </select>
          </div>
          <div class="search-bar">
            <input id="search" type="search" placeholder="Search events..." data-i18n-placeholder="search.placeholder" />
          </div>
        </div>
      </div>
      <div id="eventsList" class="events-grid"></div>
      <div id="emptyEvents" class="empty" style="display:none;" data-i18n="schedule.empty">
        No events match your filters. Check back soon.
      </div>
    </section>

    <!-- Event Detail -->
    <section id="eventDetail" class="card" style="display:none;">
      <button class="btn-ghost" id="backToSchedule">← <span data-i18n="back.schedule">Back to schedule</span></button>
      <div id="eventHeader" class="event-header"></div>
      <div id="eventActions" class="event-actions"></div>

      <div class="tabs">
        <button class="tab active" data-tab="discussion" data-i18n="tabs.discussion">Discussion</button>
        <button class="tab" data-tab="files" data-i18n="tabs.files">Files</button>
        <button class="tab" data-tab="about" data-i18n="tabs.about">About</button>
      </div>

      <div id="tab_discussion" class="tab-panel">
        <form id="newThreadForm" class="inline-form" style="display:none;">
          <input id="threadTitle" type="text" placeholder="New discussion topic…" data-i18n-placeholder="thread.placeholder" />
          <button class="btn-primary" type="submit" data-i18n="thread.create">Create Topic</button>
        </form>
        <div id="threadsList" class="threads"></div>
        <div id="emptyThreads" class="empty" style="display:none;" data-i18n="thread.empty">
          No topics yet. Start the discussion!
        </div>
      </div>

      <div id="tab_files" class="tab-panel" style="display:none;">
        <form id="uploadForm" class="inline-form" style="display:none;">
          <label for="fileInput" class="btn-secondary" data-i18n="files.choose">Choose File</label>
          <input id="fileInput" type="file" style="display:none;" />
          <span id="fileName"></span>
          <button class="btn-primary" type="submit" data-i18n="files.upload">Upload</button>
        </form>
        <div id="filesList" class="files"></div>
        <div id="emptyFiles" class="empty" style="display:none;" data-i18n="files.empty">No files yet.</div>
      </div>

      <div id="tab_about" class="tab-panel" style="display:none;">
        <div id="eventAbout" class="event-about"></div>
      </div>
    </section>

    <!-- Admin (organizers only) -->
    <section id="admin" class="card" style="display:none;">
      <h2 data-i18n="admin.title">Organizer Tools</h2>
      <form id="createEventForm" class="grid-form">
        <div>
          <label data-i18n="event.title_en">Title (EN)*</label>
          <input id="titleEn" required />
        </div>
        <div>
          <label data-i18n="event.title_es">Title (ES)</label>
          <input id="titleEs" />
        </div>
        <div class="col-span-2">
          <label data-i18n="event.desc_en">Description (EN)</label>
          <textarea id="descEn" rows="4"></textarea>
        </div>
        <div class="col-span-2">
          <label data-i18n="event.desc_es">Description (ES)</label>
          <textarea id="descEs" rows="4"></textarea>
        </div>
        <div>
          <label data-i18n="event.start">Start time*</label>
          <input id="startTime" type="datetime-local" required />
        </div>
        <div>
          <label data-i18n="event.end">End time</label>
          <input id="endTime" type="datetime-local" />
        </div>
        <div>
          <label data-i18n="event.lang">Language</label>
          <select id="eventLang">
            <option value="bi">Bilingual</option>
            <option value="en">English</option>
            <option value="es">Español</option>
          </select>
        </div>
        <div>
          <label data-i18n="event.host">Host org</label>
          <input id="hostOrg" placeholder="UNAM, University of Arizona…" />
        </div>
        <div class="col-span-2">
          <label data-i18n="event.zoom">Zoom URL (members only)</label>
          <input id="zoomUrl" type="url" placeholder="https://zoom.us/j/..." />
        </div>
         <div>
            <label data-i18n="event.reg_url">Registration URL</label>
            <input id="registrationUrl" type="url" />
        </div>
        <div>
            <label data-i18n="event.live_url">Livestream URL</label>
            <input id="livestreamUrl" type="url" />
        </div>
        <div>
            <label data-i18n="event.rec_url">Recording URL</label>
            <input id="recordingUrl" type="url" />
        </div>
        <div>
            <label data-i18n="event.tags">Tags (comma-separated)</label>
            <input id="topicTags" placeholder="agrivoltaics, policy, solar" />
        </div>
        <div class="col-span-2">
          <button class="btn-primary" type="submit" data-i18n="event.create">Create Event</button>
        </div>
      </form>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>
        © <span id="year"></span> Almuerzo Agrivoltaico • <span data-i18n="footer.note">Bilingual, community-driven seminar on agrivoltaics in Latin America.</span>
      </small>
    </div>
  </footer>

  <!-- Supabase JS via ESM CDN -->
  <script type="module" src="https://esm.sh/@supabase/supabase-js@2"></script>
  <script src="app.js" type="module"></script>
</body>
</html>